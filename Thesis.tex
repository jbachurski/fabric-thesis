\documentclass{mimosis}

\usepackage{metalogo}

\usepackage{tikz}

\usepackage{todonotes}

\usepackage{needspace}
\usepackage{etoolbox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Listings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{listings}

\definecolor{deepblue}{rgb}{0,0,0.6}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.6,0}

\def\backtick{\`{}}
\newcommand\basestyle{\lstset{
    basicstyle=\small\ttfamily,
    morekeywords={self},
    keywordstyle=\color{deepblue},
    stringstyle=\color{deepgreen},
    showstringspaces=false,
    literate={`}{\backtick}1,
    escapechar=@
}}

\newcommand\ocamlstyle{\basestyle{} \lstset{language=caml}}
\lstnewenvironment{ocaml}[1][]{\ocamlstyle \lstset{#1}}{}

\newcommand\pythonstyle{\basestyle{} \lstset{language=Python}}
\lstnewenvironment{python}[1][]{\pythonstyle \lstset{#1}}{}

\newcommand\javastyle{\basestyle{} \lstset{language=Java}}
\lstnewenvironment{java}[1][]{\javastyle \lstset{#1}}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Nomenclature
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[intoc, english]{nomencl}
\makenomenclature

% https://tex.stackexchange.com/questions/383027/nomencl-package-sort-by-order-of-appearance
\providetoggle{nomsort}
\settoggle{nomsort}{false}

\makeatletter
\iftoggle{nomsort}{%
    \let\old@@@nomenclature=\@@@nomenclature        
        \newcounter{@nomcount} \setcounter{@nomcount}{0}%
        \renewcommand\the@nomcount{\two@digits{\value{@nomcount}}}% 
        \def\@@@nomenclature[#1]#2#3{% 
          \addtocounter{@nomcount}{1}%
        \def\@tempa{#2}\def\@tempb{#3}%
          \protected@write\@nomenclaturefile{}%
          {\string\nomenclatureentry{\the@nomcount\nom@verb\@tempa @[{\nom@verb\@tempa}]%
          \begingroup\nom@verb\@tempb\protect\nomeqref{\theequation}%
          |nompageref}{\thepage}}%
          \endgroup
          \@esphack}%
      }{}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyperlinks & bookmarks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[%
  colorlinks = true,
  citecolor  = RoyalBlue,
  linkcolor  = RoyalBlue,
  urlcolor   = RoyalBlue,
  unicode,
  ]{hyperref}

\usepackage{bookmark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% I like the bibliography to be extremely plain, showing only a numeric
% identifier and citing everything in simple brackets. The first names,
% if present, will be initialized. DOIs and URLs will be preserved.

\usepackage[%
  autocite     = plain,
  backend      = biber,
  doi          = true,
  url          = true,
  giveninits   = true,
  hyperref     = true,
  maxbibnames  = 99,
  maxcitenames = 99,
  sortcites    = true,
  style        = numeric,
  ]{biblatex}

\input{bibliography-mimosis}
\addbibresource{Thesis.bib}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fonts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifxetexorluatex
  \usepackage{unicode-math}
  \setmainfont{EB Garamond}
  \setmathfont{Garamond Math}

  % Load some missing symbols from another font.
  \setmathfont{STIX Two Math}[%
    range = {
      \sharp,
      \natural,
      \flat,
      \clubsuit,
      \spadesuit,
      \checkmark
    }
  ]
  \setmonofont[Scale=MatchLowercase]{Source Code Pro}
\else
  \usepackage[lf]{ebgaramond}
  \usepackage[oldstyle,scale=0.9]{sourcecodepro}
  \singlespacing
\fi

% \newacronym{FL}{FL}{Featherweight Lua}
% \newacronym{FJ}{FJ}{Featherweight Java}

\makeindex
\makeglossaries

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Ordinals
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
\@ifundefined{st}{%
  \newcommand{\st}{\textsuperscript{\textup{st}}\xspace}
}{}
\@ifundefined{rd}{%
  \newcommand{\rd}{\textsuperscript{\textup{rd}}\xspace}
}{}
\@ifundefined{nd}{%
  \newcommand{\nd}{\textsuperscript{\textup{nd}}\xspace}
}{}
\makeatother

\renewcommand{\th}{\textsuperscript{\textup{th}}\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Theorems
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtheorem{theorem}{Theorem}[chapter]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Incipit
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Breaking records}
\subtitle{Structural subtyping in language design}
\author{Jakub Krzysztof Bachurski}

\begin{document}
%TC:ignore 
  \input{Sources/Notation}

\frontmatter
  \include{Sources/Title}
  % \include{Sources/Abstract}

  \tableofcontents

%TC:endignore 
\mainmatter

  \include{Sources/1-Introduction}
  \include{Sources/2-SoulOfDynamicTyping}
  \include{Sources/3-ConstraintBasedAlgebraicSubtyping}
  \include{Sources/4-Fabric}
  \include{Sources/5-Star}
  \include{Sources/6-Conclusions}
  
%TC:ignore 

  % This ensures that the subsequent sections are being included as root
  % items in the bookmark structure of your PDF reader.
  \bookmarksetup{startatroot}

\begingroup
  \backmatter
  \printindex
  \printbibliography
\endgroup

\addtocontents{toc}{\protect\setcounter{tocdepth}{1}}
\setcounter{chapter}{1}
\appendix 

\begingroup
  \let\clearpage\relax
  \renewcommand{\nomname}{Notation}
  \printnomenclature
\endgroup

  \include{Sources/Appendix-Proof_of_Type_Safety_for_Star}

%TC:endignore 
\end{document}