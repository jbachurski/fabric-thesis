\renewcommand\nomgroup[1]{%
  \item[\bfseries
  \ifstrequal{#1}{A}{Common symbols}{%
  \ifstrequal{#1}{B}{Common syntax}{%
  \ifstrequal{#1}{J}{Featherweight Java}{%
  \ifstrequal{#1}{L}{Featherweight Lua}{%
  \ifstrequal{#1}{P}{Type inference}{%
  \ifstrequal{#1}{S}{Subtyping and the type lattice}{%
  \ifstrequal{#1}{T}{Constraint-based algebraic subtyping}{%
  \ifstrequal{#1}{Y}{Fabric}{%
  \ifstrequal{#1}{Z}{Star}{%
  }}}}}}}}}%
]}

\makeatletter
\newcommand*\fsize{\dimexpr\f@size pt\relax}
\makeatother

\newcommand{\newnotation}[4]{\nomenclature[#4]{#2}{#3}}

\newcommand{\graintro}[1]{{#1} \,::=&\; }
\newcommand{\graitem}{\\ \mid&\;}
\newcommand{\irule}[3]{{\renewcommand\arraystretch{1.5} \begin{array}{ll} \textsc{#1} \\ \dfrac{\phantom| #2 \phantom|}{\phantom| #3 \phantom|}\end{array}}}
\newcommand{\defeq}{\stackrel{\Delta}{=}}

\newcommand{\ctx}[2]{{#1}\left\langle{#2}\right\rangle}
\newcommand{\ctxhole}{\diamond}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Symbols
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newnotation{var}{$x, y, z$}{Variable}{A010}
\newnotation{tvar}{$\alpha, \beta, \gamma$}{Type variable}{A011}
\newnotation{expr}{$e$}{Expression}{A020}
\newnotation{type}{$\tau, \pi$}{Type}{A040}
\newnotation{label}{$\ell$}{Record label}{A045}
\newnotation{tag}{$T$}{Variant tag}{A046}
\newnotation{env}{$\Gamma$}{Typing environment}{A050}

\newcommand{\substx}[1]{\left[ #1 \right]}
\newcommand{\subst}[2]{\left[ #1/#2 \right]}
\newnotation{subst}{$\subst{e}{x}e$}{Substitution}{A060}
\newcommand{\tsubst}[3]{\subst{#1}{#2}{#3}}
\newnotation{tsubst}{$\subst{\tau}{\alpha}{\tau}$}{Type substitution, with $\psi ::= \cdot \mid \psi, \tau/\alpha$}{A061}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Common syntax
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newnotation{def}{$\defeq$}{Definition}{B010}
\newnotation{rep}{$\overline t$}{Repetition of $t$}{B020}

\newcommand{\letbind}[2]{\mathrm{let}\,{#1}={#2}\,\mathrm{in}\,}
\newcommand{\letbindx}[2]{\mathrm{let}\,{#1}={#2}}
\newcommand{\fllet}[2]{\letbind{#1}{#2}}
\newcommand{\flletx}[2]{\letbindx{#1}{#2}}
% \newnotation{fllet}{$\mathrm{let}$}{Let-binding}{B030}

\newnotation{top}{$\top$}{Top type -- supertype of all types}{B048}
\newnotation{bot}{$\bot$}{Bottom type -- subtype of all types}{B049}

\newcommand{\lam}[1]{\lambda {#1} \ldotp}
\newcommand{\fllam}[1]{\lam{#1}}
% \newnotation{fllam}{$\lambda$}{Function ($\lambda$ abstraction)}{B040}

\newcommand{\rcd}[1]{\left\{ {#1} \right\}}
\newnotation{flrec}{$\rcd{\cdots}$}{Record}{B050}

\newcommand{\vrt}[1]{\left[ {#1} \right]}
\newnotation{flvrt}{$\vrt{\cdots}$}{Variant}{B050}

\newcommand{\denot}[1]{\left\llbracket{#1}\right\rrbracket}
\newcommand{\denotl}[1]{\left\lceil\!\!\left\lceil{#1}\right\rceil\!\!\right\rceil}
\newcommand{\denoty}[1]{\left(\!\left| #1
\right|\!\right)}
\newnotation{denot}{$\denot -$}{Expression translation: semantics- and type-preserving}{B064}
\newnotation{denotl}{$\denotl -$}{Expression translation: semantics-preserving}{B066}
\newnotation{denoty}{$\denoty -$}{Type translation}{B068}
\newnotation{typing}{$\Gamma \vdash e : \tau$}{Typing judgement}{B070}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Featherweight Lua
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newnotation{flfieldtype}{$\phi$}{Field type}{L030}

\newcommand{\flrec}[1]{\rcd{#1}}

\newcommand{\flext}[2]{\left\{ {#1} \,\middle|\, {#2} \right\}}
\newnotation{flext}{$\flext{\overline{\ell = e}}{e}$}{Record extension}{L040}

\newnotation{flrectyp}{$\flext{\overline{\ell : \phi}}{\phi}$}{Record type}{L045}

\newcommand{\flftop}{\top \!\!\!\! \top}
\newcommand{\flfbot}{\bot \!\!\!\! \bot}
\newcommand{\flpresent}[1]{\boxed{#1}}
\newcommand{\flabsent}{\Box}
\newnotation{flftop}{$\flftop$}{Top field type}{L046}
\newnotation{flfbot}{$\flfbot$}{Bottom field type}{L047}
\newnotation{flpresent}{$\flpresent \tau$}{Present field type}{L048}
\newnotation{flabsent}{$\flabsent$}{Absent field type}{L049}

\newcommand{\flproj}[2]{{#1}{.}{#2}}
\newnotation{flproj}{$\flproj e \ell$}{Let-binding}{L050}

\newcommand{\flcast}[2]{{#1} \vartriangleright {#2}}
\newnotation{flcast}{$\flcast{e}{\tau}$}{Runtime type coercion}{L060}

\newcommand{\centredalign}{\hspace{.45\textwidth}\phantom{{}={}}&\phantom{{}={}}\hspace{.45\textwidth}}

\newcommand{\lua}[1]{\textsf{#1}}
\newnotation{lua}{$\lua e$}{Lua expression \emph{(written in sans-serif font)}}{L070}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Featherweight Java
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\fj}[1]{\texttt{#1}}
\newcommand{\fjoverline}[1]{$\overline{\mbox{#1}}$}

\newcommand{\fjconsdef}{\fj{C(\fjoverline{C f}) \{ super($\overline{\fj{f}'}$); \fjoverline{this.f=f;} \}}}
\newcommand{\fjmethdefx}{\fj{C}' \fj{ m(\fjoverline{C x})\{ ... \}}}
\newcommand{\fjmethdef}{\fj{C}' \fj{ m(\fjoverline{C x})\{ return e; \}}}
\newcommand{\fjclassdef}{\fj{class C extends C' \{ \fjoverline{C f}; K; \fjoverline{M}; \}}}

\newnotation{fj}{$\fj e$}{Expression \emph{(written in monospace font)}}{J010}
\newnotation{fjtype}{$\fj C$}{Class}{J011}
\newnotation{fjtype}{$\fj m$}{Method name}{J012}
\newnotation{fjtype}{$\fj f$}{Field, variable name}{J013}
\newnotation{fjconsdef}{$K$}{Class constructor definition}{J020}
\newnotation{fjmethdef}{$M$}{Method definition}{J030}
\newnotation{fjclassdef}{$L$}{Class definition}{J040}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Type inference
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \newcommand{\asubst}{\psi}
% \newnotation{asubst}{$\asubst$}{Substitution, e.g.\@ in $\substx{\asubst} e = e$}{P010}

\newcommand{\sch}{\sigma}
\newnotation{sch}{$\sch$}{Type scheme}{P010}
\newnotation{inst}{$\sigma \models \tau$}{Type scheme instantiation}{P011}

\newcommand{\rec}[1]{\mu\,{#1}\ldotp}
\newnotation{rec}{$\rec \alpha \tau$}{Recursive type, where variable $\alpha$ refers to entire type when occuring in $\tau$}{P020}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Subtyping lattice
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\typeq}[0]{\equiv}
\newnotation{typeq}{$\typeq$}{Type equivalence under the Boolean algebra}{S000}

\newcommand{\sub}[0]{\leqslant}
\newnotation{sub}{$\sub$}{Subtype}{S010}

\newcommand{\super}[0]{\geqslant}
\newnotation{super}{$\super$}{Supertype}{S015}

\newcommand{\constr}[0]{K}
\newnotation{constr}{$\constr[\overline \tau]$}{Type constructor $\constr$ with type subterms $\overline \tau$}{S030}

\newcommand{\cmeet}[0]{\sqcap}
\newnotation{cmeet}{$\cmeet$}{Meet in the lattice of type constructors}{S031}

\newcommand{\cjoin}[0]{\sqcup}
\newnotation{cjoin}{$\cjoin$}{Join in the lattice of types constructors}{S032}

\newcommand{\cdecomp}[0]{\lhd}
\newnotation{cdecomp}{$\cdecomp$}{Decomposition of type constructor subtyping constraint}{S031}

\newcommand{\meet}[0]{\land}
\newnotation{meet}{$\meet$}{Meet in the lattice of types}{S035}

\newcommand{\join}[0]{\lor}
\newnotation{join}{$\lor$}{Join in the lattice of types}{S036}

\newcommand{\comp}[0]{\lnot}
\newnotation{comp}{$\comp$}{Complement in the Boolean algebra of types}{S040}

\newcommand{\subsume}[0]{\sub^\forall}
\newnotation{subsume}{$\subsume$}{Subsumption of type schemes}{S050}

\newcommand{\morph}{\theta}
\newnotation{morphism}{$\morph$}{Homomorphism in the type algebra}{S060}

\newcommand{\id}{\mathrm{id}}
\newnotation{id}{$\id$}{Identity homomorphism}{S061}

\newcommand{\ladj}[1]{\overleftarrow{#1}}
\newnotation{ladj}{$\protect\ladj{\morph}$}{Left adjoint of a type homomorphism}{S070}

\newcommand{\radj}[1]{\overrightarrow{#1}}
\newnotation{radj}{$\protect\radj{\morph}$}{Right adjoint of a type homomorphism}{S075}

\newcommand{\ladjrest}[1]{\underline{\overleftarrow{#1}}}
\newnotation{ladjrest}{$\protect\ladjrest{\morph}$}{Remainder of a left adjoint of a type homomorphism}{S080}

\newcommand{\radjrest}[1]{\underline{\overrightarrow{#1}}}
\newnotation{radjrest}{$\protect\radjrest{\morph}$}{Remainder of a right adjoint of a type homomorphism}{S085}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Constraints - algebraic subtyping
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newnotation{constr}{$c$}{Constraint}{T03}

\newcommand{\cstr}[3]{\left\langle\!\left\langle #1 \vdash #2 : #3 \right\rangle\!\right\rangle}
\newnotation{cstr}{$\cstr{\Gamma}{e}{\tau}$}{Constraint generation for $\Gamma \vdash e : \tau$}{T04}

\newcommand{\equivct}{E}
\newcommand{\equivctx}{\ctx{\equivct}{\ctxhole}}
\newnotation{equivctx}{$\equivctx$}{Type equivalence context}{T07}

\newcommand{\solvect}{C}
\newcommand{\solvectx}{\ctx{\solvect}{\ctxhole}}
\newnotation{solvectx}{$\solvectx$}{Constraint solving context}{T08}

\newcommand{\undsym}[0]{\&}
\newcommand{\und}[0]{\;\undsym\;}
\newnotation{und}{$\und$}{Conjunction of constraints}{T10}

\newcommand{\tru}[0]{\mathbf T}
\newnotation{tru}{$\tru$}{Always-true constraint}{T20}

\newcommand{\fals}[0]{\mathbf F}
\newnotation{fals}{$\fals$}{Always-false constraint}{T25}

\newcommand{\cstreq}[0]{\cong}
\newnotation{cstreq}{$\cstreq$}{Constraint equivalence under the Boolean algebra}{T29}

\newcommand{\stepsto}[0]{\to}
\newnotation{stepsto}{$\stepsto$}{Solver step}{T30}

\newnotation{solved}{$\mathcal S(c)$}{Constraint in solved form}{T31}



% \newcommand{\progressesto}[0]{\rightsquigarrow}
% \newnotation{progressesto}{$\progressesto$}{Solver progress}{T33}

% \newcommand{\goesto}[0]{\rightarrowtriangle}
% \newnotation{goesto}{$\goesto$}{Solver return}{T36}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fabric
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\fbrestricted}{\setminus}
\newnotation{fbcast}{$e \fbrestricted \ell$}{Record restriction -- removing a field $\ell$ from $e$}{Y010}

\newcommand{\fbcheck}[2]{{#1}_?{#2}}
\newnotation{fbcheck}{$\fbcheck{\ell}{e}$}{Checked projection -- a tagged value $\mathrm{Some}\,e{.}\ell$ if $\ell$ is in $e$, $\mathrm{None}\,()$ otherwise}{Y011}

\newcommand{\fbopt}[1]{?\boxed{#1}}
\newnotation{fbopt}{$\fbopt{\tau}$}{Optional field -- absent, or present with $\tau$}{Y012}

\newcommand{\fbtag}[2]{#1\,#2}
\newnotation{fbtag}{$\fbtag{T}{e}$}{Tagging}{Y020}

\newcommand{\fbuntag}[1]{!#1}
\newnotation{fbuntag}{$\fbuntag{e}$}{Untagging}{Y021}

\newcommand{\nom}{t}
\newnotation{nom}{$\nom$}{Nominal type}{Y030}

\newcommand{\fbcast}[3]{{#1} : {#2} \blacktriangleright {#3}}
\newnotation{fbcast}{$\fbcast{e}{\tau}{\tau}$}{Abbreviation-aware type cast}{Y031}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Star
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\exprcolor}[1]{#1}
\newcommand{\shapeexprcolor}[1]{#1}
\newcommand{\typecolor}[1]{#1}
\newcommand{\shapetypecolor}[1]{#1}

% \newcommand{\exprcolor}[1]{\mathcolor{RawSienna}{#1}}
% \newcommand{\shapeexprcolor}[1]{\mathcolor{BurntOrange}{#1}}
% \newcommand{\typecolor}[1]{\mathcolor{RoyalPurple}{#1}}
% \newcommand{\shapetypecolor}[1]{\mathcolor{Violet}{#1}}

\newnotation{ssexpr}{$e^S$}{Shape expression}{Z010}
\newnotation{ssval}{$s$}{Shape value}{Z011}
\newnotation{sstype}{$\sigma$}{Shape type}{Z012}

% - types
\newcommand{\sint}[0]{\typecolor{\mathrm{int}}}
\newnotation{sint}{$\sint$}{Integer type}{Z021}

\newcommand{\sfloat}[0]{\typecolor{\mathrm{float}}}
\newnotation{sfloat}{$\sfloat$}{Floating point type}{Z021}

\newnotation{sintv}{$n, m$}{Integer}{Z022}
\newnotation{sfloatv}{$f$}{Float}{Z022}

\newcommand{\sfntype}{\typecolor{\to}}
\newcommand{\fn}{\sfntype}
\newcommand{\srecordtype}[1]{\typecolor{\left\{{#1}\right\}}}
\newcommand{\svarianttype}[1]{\typecolor{\left[{#1}\right]}}

\newnotation{iota}{$\iota$}{Index for shape: upper bound on index type given shape type}{Z023}

\newcommand{\stwobounds}[2]{\typecolor{\left[ {#1}{.}{.}{#2} \right]}}
\newcommand{\sonebound}[1]{\typecolor{\left[ {#1} \right]}}
\newcommand{\sarraytype}[3]{\stwobounds{#1}{#2}{#3}}
\newcommand{\suniarraytype}[2]{\sonebound{#1}{#2}}
\newnotation{sfloat}{$\sarraytype{\sigma_1}{\sigma_2}{\tau}$}{Array type}{Z023}
\newnotation{sfloat}{$\suniarraytype{\sigma}{\tau}$}{Abbreviated array type ($\sarraytype{\sigma}{\sigma}{\tau}$)}{Z024}

% - expressions
\newcommand{\slam}[2]{\exprcolor{\lambda\,{#1} \ldotp {#2}}}
\newcommand{\slet}[3]{\exprcolor{\mathrm{let}\,#1=#2\,\mathrm{in}\,{#3}}}
\newcommand{\srecordval}[1]{\exprcolor{\left\{{#1}\right\}}}
\newcommand{\sarrayval}[2]{\exprcolor{\textsf{Arr}(#1,#2)}}
\newcommand{\sproj}[2]{\exprcolor{{#1}{.}{#2}}}
\newcommand{\stag}[2]{\exprcolor{{#1}\,{#2}}}
\newcommand{\smatch}[2]{\exprcolor{\mathrm{match}\,{#1}\,\mathrm{with}\,{#2}}}
\newcommand{\sbuild}[3]{\exprcolor{\Phi\, {#1}\left[{#2}\right] \ldotp {#3}}}
\newcommand{\sbuildempty}[2]{\sbuild{#1}{}{#2}}
\newcommand{\sindex}[2]{\exprcolor{{#1}\left[{#2}\right]}}
\newcommand{\sshape}[1]{\exprcolor{\left|{#1}\right|}}
\newcommand{\smult}{\times}

\newnotation{sarrayelemse}{$J$}{Unevaluated array elements}{Z030}
\newnotation{sarrayelemsv}{$I$}{Evaluated array elements}{Z031}
\newnotation{sarrayval}{$\sarrayval{s}{J}$}{Array literal expression}{Z032}
\newnotation{sarrayval}{$\sarrayval{s}{I}$}{Array literal value}{Z032}
\newnotation{sbuild}{$\sbuild{x}{e}{e'}$}{Array comprehension -- array of shape $e$ with element $e'$ at index $x$}{Z040}
\newnotation{sshape}{$\sshape{e}$}{Array shape access}{Z041}

% - Star shape values [we now better distinguish shape values from shape types]
% Shape values:
\newcommand{\eess}{{e^\mathrm{S}}}  %% was e_s
% \newcommand{\vess}{{v^\mathrm{S}}}  %% was v_s
\newcommand{\vess}{s}
\newcommand{\ssize}[1]{\shapeexprcolor{\#{#1}}}
\newcommand{\sproductval}[1]{\shapeexprcolor{\left\{\hspace{-2.7pt}\left|{#1}\right|\hspace{-2.7pt}\right\}}}
\newcommand{\sconcatval}[1]{\shapeexprcolor{\left\llbracket{#1}\right\rrbracket}}
\newcommand{\sbroadcast}[2]{\shapeexprcolor{{#1} \broadcast {#2}}}
\newcommand{\sproductproj}[2]{\shapeexprcolor{{{#1}\!\!\phantom{\mid}_{\circ}}#2}}
\newcommand{\sconcatproj}[2]{\shapeexprcolor{{{#1}\!\!\phantom{\mid}_{\diamond}}#2}}

\newnotation{ssize}{$\ssize{e}$}{Sized shape}{Z050}
\newnotation{sproduct}{$\sproductval{\cdots}$}{Product shape}{Z051}
\newnotation{sconcat}{$\sconcatval{\cdots}$}{Concatenation shape}{Z052}
\newnotation{sproductproj}{$\sproductproj{e}{\ell}$}{Product dimension projection}{Z053}
\newnotation{sconcatproj}{$\sconcatproj{e}{T}$}{Concatenation component projection}{Z054}

\newcommand{\broadcast}{\sqcap}
\newcommand{\broadcastsem}{\bowtie}
\newcommand{\scast}[2]{{#1} \obslash {#2}}
\newcommand{\inbs}{\vartriangleleft}
\newcommand{\inbsp}{\trianglelefteq}
\newcommand{\inbstr}{\blacktriangleleft}

\newnotation{broadcast}{$e \broadcast e$}{Broadcasting (expression)}{Z060}
\newnotation{broadcastsem}{$s \broadcastsem s$}{Broadcasting (semantics)}{Z061}
\newnotation{scast}{$\scast{v}{s}$}{Index coercion into shape}{Z062}
\newnotation{inbs}{$v \inbs s$}{Index in-bounds of shape}{Z063}
\newnotation{inbsp}{$v \inbsp s$}{Index structurally-exactly in-bounds of shape}{Z064}
\newnotation{inbstr}{$v \inbstr s$}{Index structurally-in-bounds of shape}{Z065}

% Shape types
\newcommand{\ssized}{\shapetypecolor{\#}}
\newcommand{\sproducttype}[1]{\shapetypecolor{\left\{\hspace{-2.7pt}\left|{#1}\right|\hspace{-2.7pt}\right\}}}
\newcommand{\sconcattype}[1]{\shapetypecolor{\left\llbracket{#1}\right\rrbracket}}

\newcommand{\evalct}{C}
\newcommand{\evalctx}{\ctx{\evalct}{\ctxhole}}
\newnotation{evalctx}{$\evalctx$}{Evaluation context}{Z070}

\newcommand{\step}{\leadsto}
\newcommand{\sterr}{\leadsto \lightning}
\newnotation{step}{$e \step e$}{Small-step (operational semantics)}{Z071}
\newnotation{sterr}{$e \sterr$}{Raises-error step (operational semantics)}{Z072}
\newnotation{refltransclos}{$R^*$}{Reflexive-transitive closure of relation $R$ (e.g.\@ $\step^*$, $\sterr^*$)}{Z073}
